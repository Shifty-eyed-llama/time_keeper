<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{user.firstName}}'s Profile</title>
</head>
<body>
    <div class="header">
        <div class="links">
            <a href="/end_session">Logout</a>
        <div id="pic">
            {% for pic in user.profile.all %}
            <img src="{{MEDIA_URL}}{{pic.image}}" alt="" width="100px">
            {% endfor %}
        </div>
            
        </div>
        <h1>Welcome, <a href="/dashboard/profile"></a>{{user.firstName}}</a></h1>
        <h3>What would you like to do?</h3>
        <li><a href="/dashboard/new">Start a new project</a></li>
        <li><a href="">Update your profile</a></li>


        <h1>Upload a picture</h1>
        <form action="/dashboard/create_file" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="file" name="profile_picture" id="">
            <p>
                <input type="text" name="subject" id="">
            </p>
            <button type="submit">Submit</button>
        </form>
    </div>
    <div class="wrapper">
        <div class="projects">
            <h1>All projects</h1>
            <table id='projects'>
                <thead>
                <tr>
                    <th onclick="sortTable(0)">Project Title</th>
                    <th onclick="sortTable(1)">Start Date</th>
                    <th onclick="sortTable(2)">Due Date</th>
                    <th onclick="sortTable(3)">Created By</th>
                    <th>Delete</th>
                </tr>
                </thead>
                <tbody>
            {% for project in user_projects %}
            {% if project.done == False%}
            <tr>
                <td><a href="/dashboard/view/{{ project.id }}">{{project.title}}</a></td>
                <td>{{project.start_date | safe}}</td>
                <td>{{project.end_date | safe }}</td>
                <td>{{project.created_by.firstName}}</td>
                <td><a href="/dashboard/delete_project/{{ project.id }}" onclick="return confirmDelete()">Delete</a>
                </td>
                <td><a href="/dashboard/complete_project/{{project.id}}">Complete</a></td>
            </tr>
            {% endif %}
            {% endfor %}
                </tbody>
        </table>
    </div>
</div>

<div class="projects">
    <h1>Past projects</h1>
    <table id='projects'>
        <thead>
        <tr>
            <th onclick="sortTable(0)">Project Title</th>
            <th onclick="sortTable(1)">Start Date</th>
            <th onclick="sortTable(2)">Due Date</th>
            <th onclick="sortTable(3)">Created By</th>
            <th>Delete</th>
        </tr>
        </thead>
        <tbody>
    {% for project in user_projects %}
    {% if project.done == True %}
    <tr>
        <td><a href="/dashboard/view/{{ project.id }}">{{project.title}}</a></td>
        <td>{{project.start_date | safe}}</td>
        <td>{{project.end_date | safe }}</td>
        <td>{{project.created_by.firstName}}</td>
        <td><a href="/dashboard/delete_project/{{ project.id }}" onclick="return confirmDelete()">Delete</a>
        </td>
    </tr>
    {% endif %}
    {% endfor %}
        </tbody>
</table>
</div>
<script>
    function confirmDelete() {
        return confirm("Are you REALLY sure you want to delete this project?")
    }


function sortTable(n) {
    var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
    table = document.getElementById("projects");
    switching = true;
    dir = "asc";
    while (switching) {
        switching = false;
        rows = table.rows;
        for (var j = rows.length-1; j >=0; j--){
            for (i = 1; i < (rows.length - 1); i++) {
                shouldSwitch = false;
                x = rows[i].getElementsByTagName("TD")[n];
                y = rows[i + 1].getElementsByTagName("TD")[n];
                if (dir == "asc") {
                    if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                        shouldSwitch = true;
                        break;
                    }
                } else if (dir == "desc") {
                    if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                        shouldSwitch = true;
                        break;
                    }
                }
            }
            if (shouldSwitch) {
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
                switchcount ++;
            } else {
                if (switchcount == 0 && dir == "asc") {
                    dir = "desc";
                    switching = true;
                }
            }
        }
    }
}
</script>
</body>
</html>